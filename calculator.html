<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kalkulator Gizi Z-Score - NutriKids</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Import CSS Variables dan Global Styles */
        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #3b82f6;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
            --purple: #8b5cf6;
            --bg-gradient: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --text-light: #94a3b8;
            --bg-light: #f8fafc;
            --white: #ffffff;
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.5rem;
            --radius-md: 1rem;
            --radius-lg: 1.5rem;
            --radius-xl: 2rem;
            --radius-2xl: 2.5rem;
        }

        /* RESET & BASE */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            color: var(--text-main); 
            background-color: var(--bg-light); 
            overflow-x: hidden; 
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Grid Background */
        .grid-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            background-image: 
                linear-gradient(rgba(16, 185, 129, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(16, 185, 129, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Container */
        .container { 
            width: 100%;
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 0 1.5rem; 
        }

        @media (max-width: 640px) {
            .container {
                padding: 0 1rem;
            }
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
        }

        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
        }

        h2 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
        }

        h3 {
            font-size: clamp(1.25rem, 3vw, 2rem);
        }

        p {
            margin-bottom: 1rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--primary-dark);
        }

        /* NAVIGATION */
        .nav-container { 
            padding: 1rem 0; 
            width: 100%; 
            z-index: 1000; 
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .nav-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-radius: 100px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-md);
            background: rgba(255, 255, 255, 0.9);
        }

        .brand { 
            font-size: 1.5rem; 
            font-weight: 800; 
            color: var(--primary); 
            text-decoration: none; 
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .brand span { 
            color: var(--text-main); 
        }

        .nav-cta-box {
            background: var(--primary);
            color: var(--white) !important;
            padding: 0.625rem 1.5rem !important;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-weight: 700;
        }

        .nav-cta-box:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        /* Main Content */
        main {
            padding: 2rem 0;
            position: relative;
            z-index: 1;
        }

        .page-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2.5rem;
            align-items: start;
        }

        @media (max-width: 768px) {
            .page-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            padding: 2rem;
        }

        .glass-card:hover {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1.5rem;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* Profile Info */
        .profile-card {
            border-left: 8px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .avatar-container {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            flex-shrink: 0;
        }

        .avatar-boy {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary);
            border: 2px solid rgba(59, 130, 246, 0.2);
        }

        .avatar-girl {
            background: rgba(236, 72, 153, 0.1);
            color: #ec4899;
            border: 2px solid rgba(236, 72, 153, 0.2);
        }

        .profile-info h3 {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
            color: var(--text-main);
        }

        .profile-info p {
            color: var(--primary);
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0;
        }

        /* Standards Guide */
        .standards-guide {
            margin-top: 2rem;
        }

        .standards-guide h4 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .standards-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .standard-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-md);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .standard-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .standard-text {
            flex: 1;
        }

        .standard-text b {
            color: var(--text-main);
            font-weight: 700;
        }

        .standard-text span {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Calculator Form */
        .calculator-form {
            padding: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-main);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-label i {
            color: var(--primary);
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            background: var(--white);
            color: var(--text-main);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-light);
        }

        .form-input-lg {
            font-size: 1.25rem;
            font-weight: 700;
            text-align: center;
        }

        /* Measurement Cards */
        .measurement-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 768px) {
            .measurement-cards {
                grid-template-columns: 1fr;
            }
        }

        .measurement-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .measurement-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .measurement-card.berat {
            border-color: rgba(16, 185, 129, 0.3);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(16, 185, 129, 0.1) 100%);
        }

        .measurement-card.tinggi {
            border-color: rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(59, 130, 246, 0.1) 100%);
        }

        .measurement-card.lingkar {
            border-color: rgba(139, 92, 246, 0.3);
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(139, 92, 246, 0.1) 100%);
        }

        .measurement-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.75rem;
        }

        .measurement-card.berat .measurement-icon {
            background: rgba(16, 185, 129, 0.2);
            color: var(--primary);
        }

        .measurement-card.tinggi .measurement-icon {
            background: rgba(59, 130, 246, 0.2);
            color: var(--secondary);
        }

        .measurement-card.lingkar .measurement-icon {
            background: rgba(139, 92, 246, 0.2);
            color: var(--purple);
        }

        .measurement-card h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-main);
        }

        .measurement-input {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-md);
            font-size: 1.125rem;
            font-weight: 700;
            text-align: center;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .measurement-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--white);
        }

        .measurement-unit {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.875rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
        }

        /* BUTTONS */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1rem 2rem;
            border-radius: var(--radius-lg);
            font-weight: 700;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            gap: 0.5rem;
            font-size: 1rem;
            width: 100%;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(16, 185, 129, 0.4);
        }

        .btn-icon {
            margin-left: 0.25rem;
            transition: transform 0.3s ease;
        }

        .btn-primary:hover .btn-icon {
            transform: translateX(5px);
        }

        /* Info Note */
        .info-note {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: var(--radius-lg);
            padding: 1rem;
            margin-top: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .info-note i {
            color: var(--secondary);
            font-size: 1.25rem;
            margin-top: 0.125rem;
        }

        .info-note p {
            margin-bottom: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* UTILITY CLASSES */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }

        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 1rem; }
        .mt-4 { margin-top: 1.5rem; }
        .mt-5 { margin-top: 2rem; }
        .mt-6 { margin-top: 3rem; }

        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .mb-5 { margin-bottom: 2rem; }
        .mb-6 { margin-bottom: 3rem; }

        .d-flex { display: flex; }
        .flex-column { flex-direction: column; }
        .align-items-center { align-items: center; }
        .justify-content-center { justify-content: center; }
        .justify-content-between { justify-content: space-between; }

        .w-100 { width: 100%; }
        .h-100 { height: 100%; }

        .d-none { display: none; }
        .d-block { display: block; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-inner {
                padding: 0.5rem 1rem;
            }
            
            .brand {
                font-size: 1.2rem;
            }
            
            .nav-cta-box {
                padding: 0.5rem 1rem !important;
                font-size: 0.9rem;
            }
            
            .profile-card {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .glass-card {
                padding: 1.5rem;
            }
            
            .calculator-form {
                padding: 1.5rem;
            }
            
            .measurement-cards {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 1rem;
            }
            
            .profile-info h3 {
                font-size: 1.25rem;
            }
            
            .avatar-container {
                width: 70px;
                height: 70px;
                font-size: 2rem;
            }
            
            .form-input {
                padding: 0.875rem 1rem;
                font-size: 0.875rem;
            }
            
            .btn {
                padding: 0.875rem 1.5rem;
                font-size: 0.875rem;
            }
            
            .measurement-card {
                padding: 1.25rem;
            }
            
            .measurement-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
        }

        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Print styles */
        @media print {
            .nav-container,
            .btn-print {
                display: none !important;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .glass-card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <!-- Grid Background -->
    <div class="grid-bg"></div>
    
    <!-- Header/Navigation -->
    <header class="nav-container">
        <div class="container">
            <div class="nav-inner">
                <a href="index.html" class="brand">
                    <i class="fas fa-heartbeat"></i>
                    <span>NutriKids</span>
                </a>
                <a href="inputData.html" class="nav-cta-box">
                    <i class="fas fa-arrow-left"></i> Kembali ke Dashboard
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="page-grid fade-in">
            <!-- Left Column: Information -->
            <div>
                <span class="badge badge-success">
                    <i class="fas fa-star"></i> Akurasi Z-Score WHO
                </span>
                
                <h1 class="text-4xl font-bold mb-4">
                    Cek Status Gizi <br>
                    <span id="displayNamaAnak" style="color: var(--primary);">Si Kecil</span>
                </h1>
                
                <!-- Profile Card -->
                <div class="glass-card profile-card">
                    <div id="avatarContainer" class="avatar-container avatar-boy">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="profile-info">
                        <h3 id="infoAnak">Nama Anak</h3>
                        <p id="infoUsiaGender">0 Bulan | Laki-laki</p>
                        <p id="infoDataTersimpan" style="color: var(--text-secondary); font-size: 0.875rem; font-weight: normal;">
                            <i class="fas fa-database"></i> Data tersimpan
                        </p>
                    </div>
                </div>
                
                <!-- Standards Guide -->
                <div class="standards-guide">
                    <h4><i class="fas fa-microscope"></i> Standar Antropometri:</h4>
                    <div class="standards-list">
                        <div class="standard-item">
                            <div class="standard-color" style="background-color: var(--danger);"></div>
                            <div class="standard-text">
                                <b>Gizi Buruk:</b> <span>&lt; -3 SD (Severe Underweight)</span>
                            </div>
                        </div>
                        <div class="standard-item">
                            <div class="standard-color" style="background-color: var(--warning);"></div>
                            <div class="standard-text">
                                <b>Gizi Kurang:</b> <span>-3 s/d -2 SD (Underweight)</span>
                            </div>
                        </div>
                        <div class="standard-item">
                            <div class="standard-color" style="background-color: var(--success);"></div>
                            <div class="standard-text">
                                <b>Gizi Baik:</b> <span>-2 s/d +2 SD (Normal)</span>
                            </div>
                        </div>
                        <div class="standard-item">
                            <div class="standard-color" style="background-color: var(--secondary);"></div>
                            <div class="standard-text">
                                <b>Gizi Lebih:</b> <span>&gt; +2 SD (Overweight)</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Data Tersimpan Info -->
                <div class="info-note mt-4">
                    <i class="fas fa-info-circle"></i>
                    <p>
                        Data pengukuran akan disimpan dalam rekam medis digital dan dapat diakses kapan saja.
                        Pastikan pengukuran dilakukan dengan akurat untuk hasil analisis yang optimal.
                    </p>
                </div>
            </div>
            
            <!-- Right Column: Calculator -->
            <div class="glass-card calculator-form">
                <h2 class="text-2xl font-bold mb-6">Pengukuran Antropometri</h2>
                
                <form id="calcForm">
                    <!-- Tanggal & Jam -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="tglPeriksa" class="form-label">
                                <i class="fas fa-calendar"></i> Tanggal Periksa
                            </label>
                            <input 
                                type="date" 
                                id="tglPeriksa" 
                                class="form-input" 
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="jamPeriksa" class="form-label">
                                <i class="fas fa-clock"></i> Jam Periksa
                            </label>
                            <input 
                                type="time" 
                                id="jamPeriksa" 
                                class="form-input" 
                                required
                            >
                        </div>
                    </div>
                    
                    <!-- Measurement Cards -->
                    <div class="measurement-cards">
                        <!-- Berat Badan -->
                        <div class="measurement-card berat">
                            <div class="measurement-icon">
                                <i class="fas fa-weight"></i>
                            </div>
                            <h3>Berat Badan</h3>
                            <div style="position: relative;">
                                <input 
                                    type="number" 
                                    id="berat" 
                                    class="measurement-input" 
                                    placeholder="0.0"
                                    step="0.01"
                                    min="0.5"
                                    max="50"
                                    required
                                >
                                <span class="measurement-unit">kg</span>
                            </div>
                        </div>
                        
                        <!-- Tinggi Badan -->
                        <div class="measurement-card tinggi">
                            <div class="measurement-icon">
                                <i class="fas fa-ruler-vertical"></i>
                            </div>
                            <h3>Tinggi Badan</h3>
                            <div style="position: relative;">
                                <input 
                                    type="number" 
                                    id="tinggi" 
                                    class="measurement-input" 
                                    placeholder="0.0"
                                    step="0.1"
                                    min="30"
                                    max="200"
                                    required
                                >
                                <span class="measurement-unit">cm</span>
                            </div>
                        </div>
                        
                        <!-- Lingkar Kepala -->
                        <div class="measurement-card lingkar">
                            <div class="measurement-icon">
                                <i class="fas fa-circle"></i>
                            </div>
                            <h3>Lingkar Kepala</h3>
                            <div style="position: relative;">
                                <input 
                                    type="number" 
                                    id="lingkarKepala" 
                                    class="measurement-input" 
                                    placeholder="0.0"
                                    step="0.1"
                                    min="20"
                                    max="60"
                                >
                                <span class="measurement-unit">cm</span>
                            </div>
                            <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                <i class="fas fa-info-circle"></i> Opsional
                            </p>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary mt-6">
                        <i class="fas fa-calculator"></i> Hitung & Simpan Rekapan
                        <span class="btn-icon"><i class="fas fa-rocket"></i></span>
                    </button>
                </form>
                
                <!-- Quick Tips -->
                <div class="info-note mt-4">
                    <i class="fas fa-lightbulb"></i>
                    <p>
                        <b>Tips pengukuran akurat:</b> Ukur berat badan tanpa sepatu, tinggi badan di pagi hari, 
                        dan lingkar kepala di bagian terlebar. Gunakan alat ukur yang terkalibrasi.
                    </p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Fungsi untuk menghitung Z-Score berdasarkan usia dan jenis kelamin
        function calculateZScoreBBTB(bb, tb, usiaBulan, gender) {
            // Data referensi WHO untuk BB/TB (sampel untuk usia 0-60 bulan)
            // Dalam implementasi nyata, Anda akan menggunakan tabel WHO lengkap
            
            // Median berat badan berdasarkan tinggi (contoh sederhana)
            // Ini adalah contoh - untuk implementasi nyata, gunakan tabel WHO lengkap
            let medianBB = 0;
            
            if (tb < 60) { // Bayi kecil
                medianBB = tb * 0.14;
            } else if (tb < 100) { // Balita
                medianBB = tb * 0.16;
            } else { // Anak lebih besar
                medianBB = tb * 0.18;
            }
            
            // Standard Deviation (SD) berdasarkan usia
            let sd = 0;
            if (usiaBulan < 12) {
                sd = medianBB * 0.15;
            } else if (usiaBulan < 24) {
                sd = medianBB * 0.12;
            } else {
                sd = medianBB * 0.10;
            }
            
            // Hitung Z-Score
            let zscore = (bb - medianBB) / sd;
            
            return zscore;
        }

        // Fungsi untuk menentukan status gizi berdasarkan Z-Score
        function getStatusGizi(zscore) {
            if (zscore < -3) {
                return {
                    status: "GIZI BURUK",
                    color: "var(--danger)",
                    description: "Severe Underweight",
                    recommendation: "Konsultasi segera dengan tenaga kesehatan"
                };
            } else if (zscore < -2) {
                return {
                    status: "GIZI KURANG", 
                    color: "var(--warning)",
                    description: "Underweight",
                    recommendation: "Perbaikan asupan gizi dan pemantauan rutin"
                };
            } else if (zscore <= 2) {
                return {
                    status: "GIZI BAIK",
                    color: "var(--success)",
                    description: "Normal",
                    recommendation: "Pertahankan pola makan sehat dan aktivitas fisik"
                };
            } else {
                return {
                    status: "GIZI LEBIH",
                    color: "var(--secondary)",
                    description: "Overweight",
                    recommendation: "Pengaturan pola makan dan peningkatan aktivitas fisik"
                };
            }
        }

        // Fungsi untuk menampilkan alert custom
        function showAlert(message, type = 'success') {
            const bgColor = type === 'success' ? '#10b981' : '#f59e0b';
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle';
            
            const alertDiv = document.createElement('div');
            alertDiv.innerHTML = `
                <div style="
                    background: ${bgColor};
                    color: white;
                    padding: 1rem;
                    border-radius: 0.5rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    font-weight: 600;
                    max-width: 400px;
                    width: 90%;
                ">
                    <i class="fas ${icon}" style="font-size: 1.25rem;"></i>
                    ${message}
                </div>
            `;
            
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.left = '50%';
            alertDiv.style.transform = 'translateX(-50%)';
            alertDiv.style.zIndex = '9999';
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // Inisialisasi halaman
        document.addEventListener('DOMContentLoaded', function() {
            // Ambil data profil anak dari storage
            const dataA = JSON.parse(localStorage.getItem("dataAnak"));
            const dataP = JSON.parse(localStorage.getItem("dataPosyandu"));
            
            if (!dataA) {
                showAlert('Data profil anak belum lengkap!', 'warning');
                setTimeout(() => {
                    window.location.href = "inputData.html";
                }, 1500);
                return;
            }
            
            // Update informasi anak
            const thn = Math.floor(dataA.usia / 12);
            const bln = dataA.usia % 12;
            const usiaText = thn > 0 ? `${thn} Tahun ${bln} Bulan` : `${bln} Bulan`;
            
            document.getElementById("displayNamaAnak").textContent = dataA.namaAnak;
            document.getElementById("infoAnak").textContent = dataA.namaAnak;
            document.getElementById("infoUsiaGender").textContent = `${usiaText} | ${dataA.gender}`;
            
            // Tampilkan data tersimpan jika ada
            if (dataA.beratBadan && dataA.tinggiBadan) {
                document.getElementById("infoDataTersimpan").innerHTML = 
                    `<i class="fas fa-database"></i> Data tersimpan: ${dataA.beratBadan} kg / ${dataA.tinggiBadan} cm`;
            }
            
            // Update avatar berdasarkan gender
            const avatarContainer = document.getElementById("avatarContainer");
            if (dataA.gender.toLowerCase() === "perempuan") {
                avatarContainer.className = "avatar-container avatar-girl";
                avatarContainer.innerHTML = '<i class="fas fa-female"></i>';
            } else {
                avatarContainer.className = "avatar-container avatar-boy";
                avatarContainer.innerHTML = '<i class="fas fa-male"></i>';
            }
            
            // Set tanggal dan jam otomatis
            const now = new Date();
            document.getElementById('tglPeriksa').value = now.toISOString().split('T')[0];
            document.getElementById('jamPeriksa').value = 
                now.getHours().toString().padStart(2, '0') + ':' + 
                now.getMinutes().toString().padStart(2, '0');
            
            // Isi data dari localStorage jika ada
            if (dataA.beratBadan) {
                document.getElementById('berat').value = dataA.beratBadan;
            }
            if (dataA.tinggiBadan) {
                document.getElementById('tinggi').value = dataA.tinggiBadan;
            }
            if (dataA.lingkarKepala) {
                document.getElementById('lingkarKepala').value = dataA.lingkarKepala;
            }
        });

        // Handle form submission
        document.getElementById('calcForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const dataA = JSON.parse(localStorage.getItem("dataAnak"));
            const dataP = JSON.parse(localStorage.getItem("dataPosyandu"));
            
            if (!dataA) {
                showAlert('Data profil anak belum lengkap!', 'warning');
                return;
            }
            
            // Ambil nilai dari form
            const bb = parseFloat(document.getElementById('berat').value);
            const tb = parseFloat(document.getElementById('tinggi').value);
            const lk = document.getElementById('lingkarKepala').value ? 
                parseFloat(document.getElementById('lingkarKepala').value) : null;
            const tglRaw = document.getElementById('tglPeriksa').value;
            const jam = document.getElementById('jamPeriksa').value;
            
            // Validasi input
            if (bb < 0.5 || bb > 50) {
                showAlert('Berat badan harus antara 0.5 kg dan 50 kg', 'warning');
                return;
            }
            
            if (tb < 30 || tb > 200) {
                showAlert('Tinggi badan harus antara 30 cm dan 200 cm', 'warning');
                return;
            }
            
            if (lk && (lk < 20 || lk > 60)) {
                showAlert('Lingkar kepala harus antara 20 cm dan 60 cm', 'warning');
                return;
            }
            
            // Hitung Z-Score
            const zscore = calculateZScoreBBTB(bb, tb, dataA.usia, dataA.gender);
            const statusGizi = getStatusGizi(zscore);
            
            // Format tanggal
            const d = tglRaw.split('-');
            const tglIndo = `${d[2]}/${d[1]}/${d[0]}`;
            
            // Buat objek hasil
            const hasilFinal = {
                id: new Date().getTime(),
                tanggal: tglIndo,
                jam: jam,
                namaPosyandu: dataP?.posyandu || "Posyandu Umum",
                namaAnak: dataA.namaAnak,
                namaIbu: dataA.namaIbu,
                usia: dataA.usia,
                gender: dataA.gender,
                bb: bb,
                tb: tb,
                lingkarKepala: lk,
                zscore: zscore.toFixed(2),
                status: statusGizi.status,
                color: statusGizi.color,
                description: statusGizi.description,
                recommendation: statusGizi.recommendation,
                tanggalInput: new Date().toLocaleDateString('id-ID'),
                waktuInput: new Date().toLocaleTimeString('id-ID')
            };
            
            // Simpan ke riwayat
            let riwayat = JSON.parse(localStorage.getItem("allNutriResults")) || [];
            riwayat.push(hasilFinal);
            localStorage.setItem("allNutriResults", JSON.stringify(riwayat));
            
            // Simpan hasil terakhir
            localStorage.setItem("lastNutriResult", JSON.stringify(hasilFinal));
            
            // Tampilkan konfirmasi dan redirect
            showAlert('âœ… Pengukuran berhasil disimpan!', 'success');
            
            setTimeout(() => {
                window.location.href = "hasil.html";
            }, 1500);
        });
    </script>
</body>
</html>